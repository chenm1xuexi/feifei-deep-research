REPORT_PLANNER_QUERY_WRITER_PROMPT = """
# 角色
你是一位专业的报告研究者，你非常擅长对一个报告进行研究，然后生成对应的网络搜索查询。

## 报告主题
{topic}

## 报告组织结构
{report_organization}

## 任务
你的任务是生成{number_of_queries}个网络搜索查询，以便帮助你收集相关信息，然后更好地规划报告的各个部分。
生成的搜索查询应符合以下要求：
1. 与报告主题相关
2. 满足报告组织结构中规定的要求

## 注意事项
请注意，确保查询足够具体，以便找到高质量、相关的信息，同时涵盖报告所需的广度。

## 当前时间
{now}
"""

# 主题报告规划 prompt
REPORT_PLANNER_PROMPT = """
# 需求设定
我需要一个简洁且聚焦的报告计划。

## 报告主题
报告的主题是：
{topic}

## 报告的组织结构
报告应当遵循一下组织结构：
{report_organization}

## 上下文信息
以下适用于规划报告各个部分的上下文信息：
{context}

## 任务
你的任务是生成报告的各个章节的列表，你的计划应当简洁且集中，避免出现重复的章节或者不必要的填充内容。
例如，一个好的报告结构应当如下：
1. 引言
2. 主题A概述
3. 主题B概述
4. A与B的比较
5. 结论
   每个部分应当包含以下字段：
    - name(字段类型：字符串) => 该部分的名称。
    - description(字段类型：字符串) => 简要概述该部分的主要内容。
    - research(字段类型：布尔 true/false) => 是否需要对这一章节进行联网搜索研究，推荐研究。
    - content(字段类型：字符串) => 该部分的内容，目前留空。

## 反馈
这是对报告结构的评审反馈（如果有）： 
{feedback}

## 输出结果格式示例
```json
{{
    "sections": [
        {{
            "name": "<当前章节报告的名称>",
            "description": "<当前章节涵盖主题和概念的简要概述>",
            "research": "<是否需要对当前章节进行联网搜索研究, true/false>",
            "content": "<当前章节的内容信息>"
        }},
        {{
            "name": "<当前章节报告的名称>",
            "description": "<当前章节涵盖主题和概念的简要概述>",
            "research": "<是否需要对当前章节进行联网搜索研究, true/false>",
            "content": "<当前章节的内容信息>"
        }},
        {{
            "name": "<当前章节报告的名称>",
            "description": "<当前章节涵盖主题和概念的简要概述>",
            "research": "<是否需要对当前章节进行联网搜索研究, true/false>",
            "content": "<当前章节的内容信息>"
        }} 
    ]
}}
```

## 注意事项
    - 在主要主题章节内包含示例和实施细节，而不是单独列出。
    - 确保每个章节都有明确的目的，且没有内容重叠。
    - 合并相关概念，而不是分开处理。 
    - 在提交前，审查你的结构，确保没有冗余章节内容，并且逻辑流畅。 
    - 输出结果为json，而不添加任何额外的解释说明。

## 当前时间
{now}
"""

# 联网搜索查询生成 prompt
QUERY_WRITER_PROMPT = """
# 角色
你是一位专业的技术作家，负责制定有针对性的联网搜索查询，用来收集撰写技术报告章节所需的全面信息。

## 报告主题
报告的主题是：
{topic}

## 章节（section）主题
{section_topic}

## 任务
你的目标是生成{number_of_queries}个联网搜索查询，这些查询将帮助收集关于章节主题的全面信息。
这些查询应该遵循一下规则：
1. 与主题相关
2. 考察主题的不同方面
确保能使查询具体到找到高质量、相关的信息来源。

## 当前时间
{now}
"""

# 章节 写作 prompt
SECTION_WRITER_USER_PROMPT = """
# 需求设定
请撰写研究报告的章节内容。

## 任务
1. 请仔细审查报告主题、章节（section）名称和章节主题。
2. 如果存在，审查任何现有章节内容。 
3. 然后，查看提供的资料来源。
4. 决定将使用哪些资料来源来撰写章节报告。
5. 撰写章节报告并列出您的资料来源。

## 写作指南
- 如果现有章节内容未填写，从头开始写
- 如果现有章节内容已填写，将其与资料来源综合
- 严格限制在150-300字之间
- 使用简单明了的语言
- 使用短段落（2-3句话）
- 使用##作为章节标题（Markdown格式）

## 引用规则
- 为每个独特的URL在文本中分配一个单独的引用编号
- 以 '### 引用来源' 结尾，列出每个带有对应编号的来源
- 重要提示：无论选择哪些来源，最终列表中的来源必须按顺序编号（1,2,3,4...），不得有空缺
- 示例格式：
  [1] 来源标题: URL
  [2] 来源标题: URL
  
## 最终检查
1. 验证每一条陈述都基于提供的资料来源
2. 确认每个URL仅在来源列表中出现一次
3. 验证来源按顺序编号（1,2,3...），没有空缺

## 当前时间
{now}
"""

# 章节写作输入格式要求
SECTION_WRITER_INPUTS = """ 
# 报告主题
{topic}

## 章节名称
{section_name}

## 章节主题
{section_topic}

## 现有的章节内容（如果已填充）
{section_content}

## 引用的资料来源
{context}
"""

# 章节内容评估prompt
SECTION_GRADER_PROMPT = """
# 需求设定
请根据指定的报告主题，来审查报告中的章节是否与主题相关。

## 报告主题
{topic}

## 章节主题
{section_topic}

## 章节内容
{section}

## 任务
请评估章节内容是否充分涵盖了章节主题。
如果章节内容未能充分涵盖章节主题，生成 {number_of_follow_up_queries} 个后续搜索查询以收集缺失信息。

## 输出结果格式示例
```json
{{
    "grade": "<评估结果，指示响应是否符合要求，符合 返回 pass ,不符合，需要修订，返回 fail>"
    "follow_up_queries": [
        {{
            "search_query": "后续搜索查询1" 
        }},
        {{
            "search_query": "后续搜索查询2" 
        }},
        {{
            "search_query": "后续搜索查询3"
        }}
    ]
}}
```

# 注意事项
    - 输出结果为json，而不添加任何额外的解释说明。
    
## 当前时间
{now}
"""

# 最终章节写作prompt
FINAL_SECTION_WRITER_PROMPT = """
# 角色
你是一位专业的技术文档撰写专家，结合其他研究报告章节的内容来整合撰写当前章节内容。

## 报告主题
{topic}

## 章节名称
{section_name}

## 章节主题
{section_topic}

## 可用的报告内容
{context}

## 任务
1. 特定章节撰写方式：
1.1 引言章节：
- 使用 # 表示报告标题（Markdown 格式，比如 针对xxx的研究报告）
- 字数限制：50-150 字
- 使用简单清晰的语言
- 聚焦报告的核心动机，用 1-2 段话描述
- 使用清晰的叙述逻辑引入报告
- 不包含任何结构性元素（无列表或表格）
- 不需要“来源”部分

1.2 结论/总结章节：
- 使用 ## 表示章节标题（Markdown 格式）
- 字数限制：100-250 字
- 对于比较性报告：
    1. 必须包含一个聚焦的比较表格，使用 Markdown 表格语法
    2. 表格应提炼报告中的核心见解
    3. 保持表格条目清晰简洁
- 对于非比较性报告：
    1. 仅使用 一个 结构性元素（如果有助于提炼报告中的要点）
    2. 要么使用一个聚焦的表格比较报告中的项目（使用 Markdown 表格语法）
    3. 要么使用一个简短的列表（使用正确的 Markdown 列表语法）：
        3.1 使用 * 或 - 表示无序列表
        3.2 使用 1. 表示有序列表
        3.3 确保正确的缩进和间距
    4. 以具体的后续步骤或影响作为结尾
    5.  不需要“来源”部分

2. 撰写内容要求：
- 使用具体细节而非笼统陈述
- 确保每个词都有意义
- 聚焦于最重要的核心观点

## 质量检查
- 对于引言章节：50-150 字，使用 # 表示报告标题，无结构性元素，无“来源”部分
- 对于结论章节：100-250 字，使用 ## 表示章节标题，最多仅使用一个结构性元素，无“来源”部分
- 使用 Markdown 格式
- 不要在回复中包含字数统计或任何前言

## 当前时间
{now}
"""
